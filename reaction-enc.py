# Auto-generated loader â€” decodes base64 and executes
import base64, sys
b64 = "aW1wb3J0IG9zCmltcG9ydCByZXF1ZXN0cyBhcyBycQppbXBvcnQgcmVxdWVzdHMgYXMgcngKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KZnJvbSB0aHJlYWRpbmcgaW1wb3J0IExvY2sKZnJvbSBjb25jdXJyZW50LmZ1dHVyZXMgaW1wb3J0IFRocmVhZFBvb2xFeGVjdXRvcgpmcm9tIHF1ZXVlIGltcG9ydCBRdWV1ZQppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEKaW1wb3J0IHN0cmluZwppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKaW1wb3J0IHV1aWQKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IsIGFzX2NvbXBsZXRlZApmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgdXJscGFyc2UsIHBhcnNlX3FzCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGpzb24KaW1wb3J0IHN5cwppbXBvcnQgb3MKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCByZQppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCByZXF1ZXN0cyBhcyBycQppbXBvcnQgcmVxdWVzdHMgYXMgcnEKaW1wb3J0IHRocmVhZGluZwpmcm9tIGNvbmN1cnJlbnQuZnV0dXJlcyBpbXBvcnQgVGhyZWFkUG9vbEV4ZWN1dG9yCmltcG9ydCB0aW1lLCByYW5kb20KCiMgU29mdGVyIEFOU0kgY29sb3JzCmJsdWUgPSAiXDAzM1szNG0iICAgICAjIGRhcmsgYmx1ZQpyZWQgPSAiXDAzM1szMW0iICAgICAgIyBkYXJrIHJlZAp5ZWxsb3cgPSAiXDAzM1szM20iICAgIyBkYXJrIHllbGxvdwpncmVlbiA9ICJcMDMzWzMybSIgICAgIyBncmVlbgpyZXNldCA9ICJcMDMzWzBtIgpvcmFuZ2UgPSAiXDAzM1szODs1OzIwOG0iICAjIGNhbmR5LW9yYW5nZS1saWtlCmZpbGVfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKcHVycGxlID0gIlwwMzNbMTszNW0iCnZpb2xldF9jaHUgPSAiXDAzM1sxOzM1bSIKZGFya2JsdWUgPSAiXDAzM1szNG0iCmdyZWVuID0gIlwwMzNbMTszMm0iClJFRCA9ICJcMDMzWzE7MzFtIgpZRUxMT1cgPSAiXDAzM1sxOzMzbSIKU0tZQkxVRSA9ICJcMDMzWzE7MzZtIgpCTFVFID0gIlwwMzNbMTszNG0iCkxJR0hUQkxVRSA9ICJcMDMzWzM4OzU7ODFtIgpob3RwaW5rID0gIlwwMzNbMzg7NTsxOTdtIgpsaWdodF9tYWdlbnRhID0gIlwwMzNbMzg7NTsxNzRtIgpXSElURSA9ICJcMDMzWzE7MzdtIgpsYXZlbmRlciA9ICJcMDMzWzM4OzU7MTg5bSIKcmFzcCA9ICJcMDMzWzM4OzU7MjJtIgpEQVJLQkxVRSA9ICJcMDMzWzM0bSIKR1JFRU4gPSAiXDAzM1sxOzMybSIKd2hpdGUgPSAiXDAzM1sxOzM3bSIKIyBEZWZpbmUgY29sb3JzClJFRCA9ICJcMDMzWzE7MzFtIgpHUkVFTiA9ICJcMDMzWzE7MzJtIgpZRUxMT1cgPSAiXDAzM1sxOzMzbSIKQkxVRSA9ICJcMDMzWzE7MzRtIgpXSElURSA9ICJcMDMzWzE7MzdtIgpSRVNFVCA9ICJcMDMzWzBtIgoKZGVmIHJlc29sdmVfcGZiaWRfdG9fbnVtZXJpYyhwb3N0X3VybCwgdWEpOgogICAgIiIiCiAgICBSZXNvbHZlIGEgcGZiaWQgb3Igc2hhcmUgVVJMIHRvIG51bWVyaWMgcG9zdCBJRC4KICAgICIiIgogICAgaGVhZGVycyA9IHsKICAgICAgICAiVXNlci1BZ2VudCI6IHVhLAogICAgICAgICJBY2NlcHQiOiAidGV4dC9odG1sIgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChwb3N0X3VybCwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTEwLCBhbGxvd19yZWRpcmVjdHM9VHJ1ZSkKICAgICAgICBodG1sID0gcmVzcG9uc2UudGV4dAoKICAgICAgICAjIExvb2sgZm9yIG51bWVyaWMgcG9zdCBJRCBpbiBtZXRhIHRhZ3Mgb3IgSlMKICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyJy9wb3N0cy8oXGQrKScsIGh0bWwpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKQoKICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyJyJwb3N0SUQiOiIoXGQrKSInLCBodG1sKQogICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKCiAgICAgICAgIyBmYWxsYmFjazogcmV0dXJuIG9yaWdpbmFsIFVSTCBpZiBub3QgZm91bmQKICAgICAgICByZXR1cm4gcG9zdF91cmwKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciByZXNvbHZpbmcgcGZiaWQ6IHtlfSIpCiAgICAgICAgcmV0dXJuIHBvc3RfdXJsCiAgICAKZGVmIGV4dHJhY3RfdXNlcl9pZF9wcm9mKHVybCwgdWE9Tm9uZSwgYWNjZXNzX3Rva2VuPU5vbmUpOgogICAgIiIiCiAgICBFeHRyYWN0IG51bWVyaWMgdXNlciBJRCBmcm9tIGEgRmFjZWJvb2sgcHJvZmlsZSBVUkwuCiAgICBTdXBwb3J0cyBudW1lcmljIElEIFVSTHMgYW5kIHVzZXJuYW1lIFVSTHMuCiAgICBJZiBhIHVzZXJuYW1lIGlzIHVzZWQsIGEgR3JhcGggQVBJIHJlcXVlc3QgaXMgbWFkZSB0byBnZXQgbnVtZXJpYyBJRC4KICAgICIiIgogICAgdXJsID0gdXJsLnN0cmlwKCkKICAgIAogICAgIyBGaXJzdCwgdHJ5IG51bWVyaWMgSUQgaW4gcHJvZmlsZS5waHA/aWQ9IG9yID9pZD0KICAgIG1hdGNoID0gcmUuc2VhcmNoKHInaWQ9KFxkKyl8cHJvZmlsZVwucGhwXD9pZD0oXGQrKScsIHVybCkKICAgIGlmIG1hdGNoOgogICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKSBvciBtYXRjaC5ncm91cCgyKQogICAgCiAgICAjIFRyeSBleHRyYWN0aW5nIGZyb20gL3t1c2VybmFtZX0gZm9ybWF0CiAgICBtYXRjaCA9IHJlLnNlYXJjaChyJ2ZhY2Vib29rXC5jb20vKFtcd1wuXSspJywgdXJsKQogICAgaWYgbWF0Y2g6CiAgICAgICAgdXNlcm5hbWUgPSBtYXRjaC5ncm91cCgxKQogICAgICAgICMgSWYgYWNjZXNzX3Rva2VuIHByb3ZpZGVkLCB0cnkgR3JhcGggQVBJIGxvb2t1cAogICAgICAgIGlmIGFjY2Vzc190b2tlbjoKICAgICAgICAgICAgaGVhZGVycyA9IHsiVXNlci1BZ2VudCI6IHVhfSBpZiB1YSBlbHNlIHt9CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0cy5nZXQoZidodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS97dXNlcm5hbWV9P2FjY2Vzc190b2tlbj17YWNjZXNzX3Rva2VufScsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0xMCkKICAgICAgICAgICAgICAgIGRhdGEgPSByZXNwLmpzb24oKQogICAgICAgICAgICAgICAgaWYgImlkIiBpbiBkYXRhOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhWyJpZCJdCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgSWYgbm8gYWNjZXNzX3Rva2VuLCByZXR1cm4gdXNlcm5hbWUgYXMgZmFsbGJhY2sgKHdvbid0IHdvcmsgZm9yIHJlYWN0aW9ucyB0aGF0IG5lZWQgbnVtZXJpYyBJRCkKICAgICAgICAgICAgcmV0dXJuIHVzZXJuYW1lCiAgICAKICAgIHJldHVybiBOb25lCgpkZWYgZXh0cmFjdF9mYWNlYm9va191aWRfdXJsKGZiX3VybCk6CiAgICBmYl91cmwgPSBmYl91cmwuc3RyaXAoKQogICAgcGFyc2VkID0gdXJscGFyc2UoZmJfdXJsKQogICAgcXVlcnkgPSBwYXJzZV9xcyhwYXJzZWQucXVlcnkpCgogICAgIyBHZXQgY29tbWVudF9pZCBpZiBwcmVzZW50CiAgICBjb21tZW50X2lkID0gcXVlcnkuZ2V0KCJjb21tZW50X2lkIiwgW05vbmVdKVswXQoKICAgICMgQ2FzZSAxOiAvcG9zdHMve2lkIG9yIHBmYmlkfS8KICAgIG1hdGNoID0gcmUuc2VhcmNoKHInL3Bvc3RzLyhbXHdcZF0rKScsIGZiX3VybCkKICAgIGlmIG1hdGNoOgogICAgICAgIHBvc3RfaWQgPSBtYXRjaC5ncm91cCgxKQogICAgICAgIGlmIGNvbW1lbnRfaWQ6CiAgICAgICAgICAgIHJldHVybiBmIntwb3N0X2lkfV97Y29tbWVudF9pZH0iCiAgICAgICAgcmV0dXJuIHBvc3RfaWQKCiAgICAjIENhc2UgMjogL3NoYXJlL3Yve2NvZGV9LwogICAgbWF0Y2ggPSByZS5zZWFyY2gocicvc2hhcmUvdi8oW1x3XGRdKyknLCBmYl91cmwpCiAgICBpZiBtYXRjaDoKICAgICAgICBwb3N0X2lkID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICBpZiBjb21tZW50X2lkOgogICAgICAgICAgICByZXR1cm4gZiJ7cG9zdF9pZH1fe2NvbW1lbnRfaWR9IgogICAgICAgIHJldHVybiBwb3N0X2lkCgogICAgIyBDYXNlIDM6IHBlcm1hbGluay5waHA/c3RvcnlfZmJpZD0uLi4maWQ9Li4uCiAgICBpZiAic3RvcnlfZmJpZCIgaW4gcXVlcnk6CiAgICAgICAgcG9zdF9pZCA9IHF1ZXJ5WyJzdG9yeV9mYmlkIl1bMF0KICAgICAgICBpZiBjb21tZW50X2lkOgogICAgICAgICAgICByZXR1cm4gZiJ7cG9zdF9pZH1fe2NvbW1lbnRfaWR9IgogICAgICAgIHJldHVybiBwb3N0X2lkCgogICAgIyBDYXNlIDQ6IG51bWVyaWMgcG9zdCBJRCBmYWxsYmFjawogICAgbWF0Y2ggPSByZS5zZWFyY2gocicvKFxkezEwLH0pJywgZmJfdXJsKQogICAgaWYgbWF0Y2g6CiAgICAgICAgcG9zdF9pZCA9IG1hdGNoLmdyb3VwKDEpCiAgICAgICAgaWYgY29tbWVudF9pZDoKICAgICAgICAgICAgcmV0dXJuIGYie3Bvc3RfaWR9X3tjb21tZW50X2lkfSIKICAgICAgICByZXR1cm4gcG9zdF9pZAoKICAgIHJldHVybiBOb25lCgpkZWYgcmFuZG9tX3N0cmluZyhsZW5ndGgpOgogICAgcmV0dXJuICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoc3RyaW5nLmFzY2lpX2xldHRlcnMgKyBzdHJpbmcuZGlnaXRzLCBrPWxlbmd0aCkpCgpkZWYgZ2VuZXJhdGVfdXNlcl9hZ2VudF9waCgpOgogICAgYnJhbmRzID0gewogICAgICAgICJIdWF3ZWkiOiBbIk5FTi1MWDEiLCAiRFVCLUxYMiIsICJBTkUtTFgySiIsICJWT0ctTDI5IiwgIlA0MCBMaXRlIiwgIk1hdGUgMzAgUHJvIl0sCiAgICAgICAgIkFzdXMiOiBbIlplbkZvbmUgOCIsICJST0cgUGhvbmUgNSIsICJaZW5Gb25lIDciLCAiUk9HIFBob25lIDMiLCAiWmVuRm9uZSA2IiwgIlJPRyBQaG9uZSBJSSJdLAogICAgICAgICJsZW5vdm8iOiBbIkxlZ2lvbiBQaG9uZSBEdWVsIDIiLCAiTGVnaW9uIFBob25lIER1ZWwiLCAiSzEyIE5vdGUiLCAiSzEwIE5vdGUiXSwKICAgICAgICAiVml2byI6IFsiVjIxMzAiLCAiWTkxQyIsICJWMjAyNyIsICJZMjAiLCAiWTEycyIsICJWMjFlIiwgIlkzM3MiXSwKICAgICAgICAiU2Ftc3VuZyI6IFsiU00tRzk5OCIsICJTTS1BMzI1RiIsICJTTS1KNDE1Rk4iLCAiU00tQTcxNUYiLCAiU00tQTUzNkIiLCAiU00tQTIzNUYiXSwKICAgICAgICAiWGlhb21pIjogWyIyMjAxMTE3VEciLCAiTTIwMDZDM0xHIiwgIjIyMDQxMjE5UEciLCAiTTIxMDFLNkciLCAiUmVkbWkgTm90ZSAxMCJdLAogICAgICAgICJSZWFsbWUiOiBbIlJNWDM2MjAiLCAiUk1YMTk0MSIsICJSTVgzMDg1IiwgIlJNWDIxOTMiLCAiQzM1IiwgIk5hcnpvIDUwQSJdLAogICAgICAgICJJbmZpbml4IjogWyJYNjgzM0IiLCAiWDY4OEMiLCAiWDY3MTYiLCAiWDY4MTUiLCAiSG90IDEyIiwgIk5vdGUgMTIiLCAiWmVybyA1RyJdLAogICAgICAgICJTYW1zdW5nIjogWyJHYWxheHkgUzIxIiwgIkdhbGF4eSBTMjErIiwgIkdhbGF4eSBTMjEgVWx0cmEiLCAiR2FsYXh5IFMyMCIsICJHYWxheHkgUzIwKyIsXX0KCiAgICBicmFuZCA9IHJhbmRvbS5jaG9pY2UobGlzdChicmFuZHMua2V5cygpKSkKICAgIG1vZGVsID0gcmFuZG9tLmNob2ljZShicmFuZHNbYnJhbmRdKQoKICAgIGFuZHJvaWRfdmVyc2lvbiA9IHJhbmRvbS5jaG9pY2UoWyI5IiwgIjEwIiwgIjExIiwgIjEyIiwgIjEzIiwgIjE0Il0pCiAgICBmYmF2ID0gZiJ7cmFuZG9tLnJhbmRpbnQoNTIwLDU0MCl9LntyYW5kb20ucmFuZGludCgwLDIpfS57cmFuZG9tLnJhbmRpbnQoMCw5OSl9LntyYW5kb20ucmFuZGludCg1MCwxNTApfSIKICAgIGZiYnYgPSByYW5kb20ucmFuZGludCg0NjAwMDAwMDAsIDQ4MDAwMDAwMCkKCiAgICBkZW5zaXR5ID0gcmFuZG9tLmNob2ljZShbMi4wLCAyLjUsIDIuOCwgMy4wLCAzLjIsIDMuNSwgNC4wXSkKICAgIHdpZHRoID0gcmFuZG9tLmNob2ljZShbNzIwLCAxMDgwLCAxNDQwXSkKICAgIGhlaWdodCA9IHJhbmRvbS5jaG9pY2UoWzE1MjAsIDE2MDAsIDIzNDAsIDI0MDAsIDI0NjBdKQoKICAgICMgUEggbG9jYWxlIG9ubHkKICAgIGxvY2FsZSA9IHJhbmRvbS5jaG9pY2UoWyJlbl9VUyIsImVuX1BIIiwgInRsX1BIIl0pCgogICAgIyBGYWtlIGJ1dCByZWFsaXN0aWMgSURzCiAgICBkZXZpY2VfaWQgPSByYW5kb21fc3RyaW5nKDE2KQogICAgYW5kcm9pZF9pZCA9IHJhbmRvbV9zdHJpbmcoMTYpCgogICAgdWEgPSAoCiAgICAgICAgZiJbRkJBTi9GQjRBOyIKICAgICAgICBmIkZCQVYve2ZiYXZ9OyIKICAgICAgICBmIkZCQlYve2ZiYnZ9OyIKICAgICAgICBmIkZCRE0ve3tkZW5zaXR5PXtkZW5zaXR5fSx3aWR0aD17d2lkdGh9LGhlaWdodD17aGVpZ2h0fX19OyIKICAgICAgICBmIkZCTEMve2xvY2FsZX07IgogICAgICAgIGYiRkJNRi97YnJhbmR9OyIKICAgICAgICBmIkZCQkQve2JyYW5kfTsiCiAgICAgICAgZiJGQlBOL2NvbS5mYWNlYm9vay5rYXRhbmE7IgogICAgICAgIGYiRkJEVi97bW9kZWx9OyIKICAgICAgICBmIkZCU1YvQW5kcm9pZCB7YW5kcm9pZF92ZXJzaW9ufTsiCiAgICAgICAgZiJGQk9QLzE7IgogICAgICAgIGYiRkJDQS9hcm02NC12OGE7IgogICAgICAgIGYiREVWSUNFLUlEL3tkZXZpY2VfaWR9OyIKICAgICAgICBmIkFORFJPSUQtSUQve2FuZHJvaWRfaWR9XSIKICAgICkKICAgIHJldHVybiB1YQoKZGVmIGNsZWFyX3NjcmVlbigpOgogICAgIyBXb3JrcyBvbiBXaW5kb3dzIGFuZCBVbml4LCBhbmQgY2xlYXJzIHNjcm9sbGJhY2sgYnVmZmVyCiAgICBpZiBvcy5uYW1lID09ICdudCc6CiAgICAgICAgb3Muc3lzdGVtKCdjbHMnKQogICAgICAgIHByaW50KCJcMDMzWzNKIiwgZW5kPScnKSAgIyBjbGVhcnMgc2Nyb2xsYmFjayBidWZmZXIgaW4gV2luZG93cyB0ZXJtaW5hbAogICAgZWxzZToKICAgICAgICBvcy5zeXN0ZW0oJ2NsZWFyJykKICAgICAgICBwcmludCgiXDAzM1szSiIsIGVuZD0nJykgICMgY2xlYXJzIHNjcm9sbGJhY2sgYnVmZmVyIGluIFVuaXggdGVybWluYWwKCmRlZiBleHRyYWN0X3Bvc3RfaWRzX3YxKHVybCk6CiAgICBncm91cF9wYXR0ZXJuID0gcidncm91cHMvKFxkKykvcGVybWFsaW5rLyhcZCspLycKICAgIHBvc3RfcGF0dGVybiA9IHInKFxkKykvcG9zdHMvKFxkKykvJwogICAgcGhvdG9fcGF0dGVybiA9IHInZmJpZD0oXGQrKScKCiAgICBncm91cF9tYXRjaCA9IHJlLnNlYXJjaChncm91cF9wYXR0ZXJuLCB1cmwpCiAgICBwb3N0X21hdGNoID0gcmUuc2VhcmNoKHBvc3RfcGF0dGVybiwgdXJsKQogICAgcGhvdG9fbWF0Y2ggPSByZS5zZWFyY2gocGhvdG9fcGF0dGVybiwgdXJsKQoKICAgIGlmIGdyb3VwX21hdGNoOgogICAgICAgIGdyb3VwX2lkLCBwb3N0X2lkID0gZ3JvdXBfbWF0Y2guZ3JvdXBzKCkKICAgICAgICByZXR1cm4gZiJ7Z3JvdXBfaWR9X3twb3N0X2lkfSIKICAgIGVsaWYgcG9zdF9tYXRjaDoKICAgICAgICBncm91cF9pZCwgcG9zdF9pZCA9IHBvc3RfbWF0Y2guZ3JvdXBzKCkKICAgICAgICByZXR1cm4gZiJ7Z3JvdXBfaWR9X3twb3N0X2lkfSIKICAgIGVsaWYgcGhvdG9fbWF0Y2g6CiAgICAgICAgcGhvdG9faWQgPSBwaG90b19tYXRjaC5ncm91cCgxKQogICAgICAgIHJldHVybiBwaG90b19pZAogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZSAKCmZpbGVfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkgICMgbWFrZSBzdXJlIHRoaXMgaXMgZGVjbGFyZWQgZ2xvYmFsbHkgb25jZQoKZGVmIEFjY291bnRfRXh0cmFjdGlvbih1aWRfb3JfZW1haWwsIHB3LCBwYXRoX2ZpbGUsIGV4dHJhY3RfdHlwZSwgc3VjY2Vzc19jb3VudCwgZXhpc3RpbmdfdWlkcyk6CiAgICBhY2Nlc3NUb2tlbiA9ICczNTA2ODU1MzE3Mjh8NjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInICAjIEV4YW1wbGUgYXBwIHRva2VuCgogICAgZGF0YSA9IHsKICAgICAgICAnbWV0aG9kJzogJ2F1dGgubG9naW4nLAogICAgICAgICdmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWUnOiAnYXV0aGVudGljYXRlJywKICAgICAgICAnZmJfYXBpX2NhbGxlcl9jbGFzcyc6ICdjb20uZmFjZWJvb2suYWNjb3VudC5sb2dpbi5wcm90b2NvbC5GYjRhQXV0aEhhbmRsZXInLAogICAgICAgICdhcGlfa2V5JzogJzYyZjhjZTlmNzRiMTJmODRjMTIzY2MyMzQzN2E0YTMyJywKICAgICAgICAnZW1haWwnOiB1aWRfb3JfZW1haWwsCiAgICAgICAgJ3Bhc3N3b3JkJzogcHcsCiAgICAgICAgJ2FjY2Vzc190b2tlbic6IGFjY2Vzc1Rva2VuCiAgICB9CgogICAgdXJsID0gJ2h0dHBzOi8vYi1ncmFwaC5mYWNlYm9vay5jb20vYXV0aC9sb2dpbj9pbmNsdWRlX2hlYWRlcnM9ZmFsc2UmZGVjb2RlX2JvZHlfanNvbj1mYWxzZSZzdHJlYW1hYmxlX2pzb25fcmVzcG9uc2U9dHJ1ZScKCiAgICB0aW1lLnNsZWVwKHJhbmRvbS51bmlmb3JtKDEsMikpCgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9ZGF0YSkuanNvbigpCgogICAgICAgIGlmICdhY2Nlc3NfdG9rZW4nIGluIHJlc3BvbnNlOgogICAgICAgICAgICB0b2tlbiA9IHJlc3BvbnNlWydhY2Nlc3NfdG9rZW4nXQogICAgICAgICAgICBzZXNzaW9uX2tleSA9IHJlc3BvbnNlLmdldCgnc2Vzc2lvbl9rZXknLCAnJykKICAgICAgICAgICAgbWFjaGluZV9pZCA9IHJlc3BvbnNlLmdldCgnbWFjaGluZV9pZCcsICcnKQogICAgICAgICAgICBzZWNyZXQgPSByZXNwb25zZS5nZXQoJ3NlY3JldCcsICcnKQogICAgICAgICAgICB1aWQgPSBzdHIocmVzcG9uc2UuZ2V0KCd1aWQnLCB1aWRfb3JfZW1haWwpKQoKICAgICAgICAgICAgd2l0aCBmaWxlX2xvY2s6CiAgICAgICAgICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgICAgICAgICBwcmludCgiICAgIFwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAgXDAzM1szM21bRFVQTElDQVRFIEFDQ09VTlRdXDAzM1swbTogQWxyZWFkeSBleHRyYWN0ZWQg4oaSIHt1aWR9IikKICAgICAgICAgICAgICAgICAgICBwcmludCgiICAgIFwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgICAgICAgICAjIFNhdmUgdWlkfHBhc3N3b3JkfGFjY2Vzc190b2tlbgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGhfZmlsZSwgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7dWlkfXx7cHd9fHt0b2tlbn1cbiIpCgogICAgICAgICAgICAgICAgcHJpbnQoIiAgICBcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgICAgXDAzM1szMm1bU1VDQ0VTU11cMDMzIEV4dHJhY3RlZCBBY2NvdW50IOKGkiB7dWlkfXx7cHd9IikKICAgICAgICAgICAgICAgIHByaW50KCIgICAgXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgICAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQuYXBwZW5kKHVpZCkKICAgICAgICAgICAgICAgIGV4aXN0aW5nX3VpZHMuYWRkKHVpZCkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdWlkID0gc3RyKHJlc3BvbnNlLmdldCgndWlkJywgdWlkX29yX2VtYWlsKSkgICMgZmFsbGJhY2sKICAgICAgICAgICAgcHJpbnQoIiAgICBcMDMzWzE7Mzdt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICAgICAgICAgIHByaW50KGYiICAgICBcMDMzWzMxbVtGQUlMRURdXDAzM1swbTogVE8gRVhUUkFDVCBBY2NvdW50IOKUgOKUgOKUgOKUgOKUgD4ge3VpZF9vcl9lbWFpbH17cHd9LiIpCiAgICAgICAgICAgIHByaW50KCIgICAgXDAzM1sxOzM3beKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIltFUlJPUl0ge3VpZF9vcl9lbWFpbH06IHtzdHIoZSl9IikKCmRlZiBjb3VudF90b2tlbnMoYWNjb3VudHNfZmlsZSk6CiAgICAiIiJDb3VudCB0aGUgbnVtYmVyIG9mIGFjY291bnRzIGFuZCBwYWdlcyBzdG9yZWQgaW4gdGhlIHJlc3BlY3RpdmUgZmlsZXMuIiIiCiAgICB0b3RhbF9hY2NvdW50cyA9IDAKICAgIHRvdGFsX3BhZ2VzID0gMAoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oYWNjb3VudHNfZmlsZSwgJ3InKSBhcyBhZjoKICAgICAgICAgICAgdG90YWxfYWNjb3VudHMgPSBzdW0oMSBmb3IgbGluZSBpbiBhZiBpZiBsaW5lLnN0cmlwKCkpICAjIENvdW50IG5vbi1lbXB0eSBsaW5lcwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgIHByaW50KGYiQWNjb3VudCBmaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKCiAgICByZXR1cm4gdG90YWxfYWNjb3VudHMKCmRlZiBhY2NvdW50KGFjY291bnRzX2ZpbGUsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUpOgogICAgIiIiUHJvY2VzcyB0aGUgYWNjb3VudHMgYW5kIGV4dHJhY3QgdG9rZW5zIGNvbmN1cnJlbnRseS4iIiIKICAgIHN1Y2Nlc3NfY291bnQgPSBbXQoKICAgICMgTG9hZCBleGlzdGluZyB1aWRzIHRvIHNraXAgZHVwbGljYXRlcwogICAgZXhpc3RpbmdfdWlkcyA9IHNldCgpCiAgICBpZiBvcy5wYXRoLmV4aXN0cyh0b2tlbl9vdXRwdXRfcGF0aCk6CiAgICAgICAgd2l0aCBvcGVuKHRva2VuX291dHB1dF9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIGV4aXN0aW5nX3VpZHMgPSB7bGluZS5zcGxpdCgnfCcpWzBdIGZvciBsaW5lIGluIGYucmVhZGxpbmVzKCl9CgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihhY2NvdW50c19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICAgICAgICAgIGFjY291bnRzID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlIGlmICd8JyBpbiBsaW5lLnN0cmlwKCldCgogICAgICAgIGlmIG5vdCBhY2NvdW50czoKICAgICAgICAgICAgcHJpbnQoZiJObyB2YWxpZCBhY2NvdW50cyBmb3VuZCBpbiB7YWNjb3VudHNfZmlsZX0uIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPTMwKSBhcyBleGVjdXRvcjoKICAgICAgICAgICAgZnV0dXJlcyA9IFsKICAgICAgICAgICAgICAgIGV4ZWN1dG9yLnN1Ym1pdCgKICAgICAgICAgICAgICAgICAgICBBY2NvdW50X0V4dHJhY3Rpb24sIHVpZCwgcHcsIHRva2VuX291dHB1dF9wYXRoLCBleHRyYWN0X3R5cGUsIHN1Y2Nlc3NfY291bnQsIGV4aXN0aW5nX3VpZHMKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGZvciB1aWQsIHB3IGluIChhY2Muc3BsaXQoJ3wnKSBmb3IgYWNjIGluIGFjY291bnRzKQogICAgICAgICAgICBdCgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGZ1dHVyZXM6CiAgICAgICAgICAgICAgICBmdXR1cmUucmVzdWx0KCkKCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKICAgICAgICBwcmludChmIlwwMzNbMTszNG1bU1VDQ0VTU11cMDMzWzBtOiB7bGVuKHN1Y2Nlc3NfY291bnQpfSB7ZXh0cmFjdF90eXBlfShzKSBzdWNjZXNzZnVsbHkgZXh0cmFjdGVkLiIpCiAgICAgICAgcHJpbnQoIlwwMzNbMTszN23ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIBcMDMzWzBtIikKCiAgICBleGNlcHQgRmlsZU5vdEZvdW5kRXJyb3I6CiAgICAgICAgcHJpbnQoZiJGaWxlIG5vdCBmb3VuZDoge2FjY291bnRzX2ZpbGV9IikKCmRlZiBleHRyYWN0aW9uX2FjY291bnQoKToKICAgIGNsZWFyX3NjcmVlbigpCiAgICBwcmludChmIntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBwcmludChmInt3aGl0ZX1bMV0ge29yYW5nZX1FWFRSQUNUIEFDQ09VTlQiKQogICAgcHJpbnQoZiJ7d2hpdGV9WzBdIHtyZWR9RVhJVCIpCiAgICBwcmludChmIntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBjaG9pY2UgPSBpbnB1dChmIntncmVlbn1DSE9JQ0U6ICIpLnN0cmlwKCkgCiAgICBpZiBjaG9pY2UgPT0gJzEnOgogICAgICAgIEV4dHJhY3RfQWNjb3VudCgpCiAgICBlbGlmIGNob2ljZSA9PSAnMCc6CiAgICAgICAgbWFpbigpCiAgICBlbHNlOgogICAgICAgIHByaW50KGYiICAgICB7cmVkfUlOVkFMSUQgQ0hPSUNFIikKCmRlZiBFeHRyYWN0X0FjY291bnQoKToKICAgIGZvbGRlcl9wYXRoID0gIi9zZGNhcmQvRkItU01NIgogICAgcHJpbnQoZiJ7UkVEfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgcHJpbnQoZiJcMDMzWzMxbVsxXSBcMDMzWzMybUVYVFJBQ1QgQUNDT1VOVCIpCiAgICBwcmludChmIlwwMzNbMzFtWzBdIFwwMzNbMzJtRVhJVCIpCiAgICBwcmludChmIntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXDAzM1swbSIpCiAgICBzYXZlX2Nob2ljZSA9IGlucHV0KGYiXDAzM1szMm1DSE9JQ0V7cmVzZXR9IDogIikuc3RyaXAoKQoKICAgIGlmIHNhdmVfY2hvaWNlID09ICcxJzoKICAgICAgICBhY2NvdW50X2ZpbGUgPSBvcy5wYXRoLmpvaW4oZm9sZGVyX3BhdGgsICJBQ0NPVU5ULnR4dCIpCiAgICAgICAgZXh0cmFjdF90eXBlID0gJ2FjY291bnQnCiAgICBlbGlmIHNhdmVfY2hvaWNlID09ICcwJzoKICAgICAgICBtYWluKCkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiBFeGl0aW5nLiIpCiAgICAgICAgcmV0dXJuCgogICAgcHJpbnQoZiJ7UkVEfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFwwMzNbMG0iKQogICAgZmlsZV9wYXRoID0gaW5wdXQoZiJcMDMzWzMzbVRYVCBQQVRIe3Jlc2V0fSA6ICIpLnN0cmlwKCkKCiAgICB0b2tlbl9vdXRwdXRfcGF0aCA9IGFjY291bnRfZmlsZQoKICAgIGFjY291bnQoZmlsZV9wYXRoLCB0b2tlbl9vdXRwdXRfcGF0aCwgZXh0cmFjdF90eXBlKQoKZGVmIGdldF9jb21iaW5lZF9kYXRhKHVybCk6CiAgICAiIiIKICAgIEZldGNoIHRoZSByZXNwb25zZSBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIGV4dHJhY3QgdGhlIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAuCiAgICBDb21iaW5lIHRoZXNlIHZhbHVlcyBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgogICAgQXJnczoKICAgICAgICB1cmwgKHN0cik6IFRoZSBVUkwgdG8gZmV0Y2ggZGF0YSBmcm9tLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgY29tYmluZWQgc3RyaW5nIG9mIGBhY3Ryc2AgbnVtYmVyIGFuZCBgcG9zdF9pZGAsIG9yIGFuIGVycm9yIG1lc3NhZ2UuCiAgICAiIiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ1VzZXItQWdlbnQnOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzOC4wLjAuMCBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAnQWNjZXB0JzogInRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuNyIsCiAgICAgICAgJ2NhY2hlLWNvbnRyb2wnOiAibWF4LWFnZT0wIiwKICAgICAgICAnZHByJzogIjIiLAogICAgICAgICd2aWV3cG9ydC13aWR0aCc6ICI5ODAiLAogICAgICAgICdzZWMtY2gtdWEnOiAiXCJHb29nbGUgQ2hyb21lXCI7dj1cIjEzMVwiLCBcIkNocm9taXVtXCI7dj1cIjEzMVwiLCBcIk5vdF9BIEJyYW5kXCI7dj1cIjI0XCIiLAogICAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogIj8wIiwKICAgICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtJzogIlwiTGludXhcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybS12ZXJzaW9uJzogIlwiXCIiLAogICAgICAgICdzZWMtY2gtdWEtbW9kZWwnOiAiXCJcIiIsCiAgICAgICAgJ3NlYy1jaC11YS1mdWxsLXZlcnNpb24tbGlzdCc6ICJcIkdvb2dsZSBDaHJvbWVcIjt2PVwiMTMxLjAuNjc3OC4xMDRcIiwgXCJDaHJvbWl1bVwiO3Y9XCIxMzEuMC42Nzc4LjEwNFwiLCBcIk5vdF9BIEJyYW5kXCI7dj1cIjI0LjAuMC4wXCIiLAogICAgICAgICdzZWMtY2gtcHJlZmVycy1jb2xvci1zY2hlbWUnOiAibGlnaHQiLAogICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzogIjEiLAogICAgICAgICdzZWMtZmV0Y2gtc2l0ZSc6ICJzYW1lLW9yaWdpbiIsCiAgICAgICAgJ3NlYy1mZXRjaC1tb2RlJzogIm5hdmlnYXRlIiwKICAgICAgICAnc2VjLWZldGNoLXVzZXInOiAiPzEiLAogICAgICAgICdzZWMtZmV0Y2gtZGVzdCc6ICJkb2N1bWVudCIsCiAgICAgICAgJ2FjY2VwdC1sYW5ndWFnZSc6ICJlbi1VUyxlbjtxPTAuOSIsCiAgICAgICAgJ3ByaW9yaXR5JzogInU9MCwgaSIsCiAgICAgICAgJ0Nvb2tpZSc6ICJzYj1mdVpUWjhaeWw5ZFhqNVRGb2RseERyR0Q7IGRwcj0yOyB3ZD05ODB4MTYyODsgZGF0cj1mdVpUWnhMLWd0YkJqVGtmZUJxLVZWRFoiCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKS50ZXh0CgogICAgICAgICMgRXh0cmFjdCBgYWN0cnNgIG51bWJlcgogICAgICAgIGFjdHJzX21hdGNoID0gcmUuc2VhcmNoKHInImFjdHJzXFwiOlxcIihcZCspXFwiJywgcmVzcG9uc2UpCiAgICAgICAgYWN0cnNfbnVtYmVyID0gYWN0cnNfbWF0Y2guZ3JvdXAoMSkgaWYgYWN0cnNfbWF0Y2ggZWxzZSBOb25lCgogICAgICAgICMgRXh0cmFjdCBgcG9zdF9pZGAKICAgICAgICBwb3N0X2lkX21hdGNoID0gcmVzcG9uc2Uuc3BsaXQoJyJwb3N0X2lkIjoiJylbMV0uc3BsaXQoJyInKVswXSBpZiAnInBvc3RfaWQiOiInIGluIHJlc3BvbnNlIGVsc2UgTm9uZQoKICAgICAgICBpZiBhY3Ryc19udW1iZXIgYW5kIHBvc3RfaWRfbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiBmInthY3Ryc19udW1iZXJ9X3twb3N0X2lkX21hdGNofSIKICAgICAgICBlbGlmIG5vdCBhY3Ryc19udW1iZXI6CiAgICAgICAgICAgIHJldHVybiAiYWN0cnMgbnVtYmVyIG5vdCBmb3VuZCEiCiAgICAgICAgZWxpZiBub3QgcG9zdF9pZF9tYXRjaDoKICAgICAgICAgICAgcmV0dXJuICJwb3N0X2lkIG5vdCBmb3VuZCEiCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBmIkFuIGVycm9yIG9jY3VycmVkOiB7c3RyKGUpfSIKCmRlZiBQZXJmb3JtX1JlYWN0X1Bvc3RfUGhvdG9fVmlkZW9fUmVlbHModG9rZW5fbGluZSwgdWlkX3VybCwgcmVhY3Rpb25fdHlwZSk6CiAgICB0cnk6CiAgICAgICAgcGFydHMgPSB0b2tlbl9saW5lLnN0cmlwKCkuc3BsaXQoJ3wnKQogICAgICAgIGlmIGxlbihwYXJ0cykgPCAzOiAKICAgICAgICAgICAgcmV0dXJuIE5vbmUsIEZhbHNlLCAiSW52YWxpZCB0b2tlbiBmb3JtYXQiLCBOb25lCgogICAgICAgIHVpZCA9IHBhcnRzWzBdCiAgICAgICAgYWNjZXNzX3Rva2VuID0gcGFydHNbMl0KICAgICAgCiAgICAgICAgIyB5b3VyIHRva2VuIGZpbGUgb25seSBoYXMgNSBwYXJ0cywgc28gVUEgaXMgbm90IHN0b3JlZDsgZ2VuZXJhdGUgb25lCiAgICAgICAgdWEgPSBnZW5lcmF0ZV91c2VyX2FnZW50X3BoKCkgICMgcmV0dXJucyBhIHVzZXIgYWdlbnQgc3RyaW5nCiAgICAgICAgdXJsID0gZiJodHRwczovL2ItZ3JhcGguZmFjZWJvb2suY29tL3t1aWRfdXJsfS9yZWFjdGlvbnMiCiAgICAgICAgcGF5bG9hZCA9IHsidHlwZSI6IHJlYWN0aW9uX3R5cGUsICJhY2Nlc3NfdG9rZW4iOiBhY2Nlc3NfdG9rZW59CiAgICAgICAgaGVhZGVycyA9IHsiVXNlci1BZ2VudCI6IHVhLAogICAgICAgICAgICAgICAgICAgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIjogImtlZXAtYWxpdmUiLAogICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiCiAgICAgICAgfQogICAgICAgIHRpbWUuc2xlZXAocmFuZG9tLnVuaWZvcm0oMSwyKSkKICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTIwKQoKICAgICAgICBpZiByLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGF0YSA9IHIuanNvbigpCiAgICAgICAgICAgICAgICBpZiBkYXRhLmdldCgic3VjY2VzcyIpIGlzIFRydWU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgVHJ1ZSwgIlJlYWN0ZWQiLCB1YQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWNjZXNzX3Rva2VuLCBGYWxzZSwgIkFscmVhZHkgcmVhY3RlZCBvciBubyBjaGFuZ2UiLCB1YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgRmFsc2UsICJJbnZhbGlkIEpTT04gcmVzcG9uc2UiLCB1YQoKICAgICAgICBlbHNlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBlcnJvcl9kYXRhID0gci5qc29uKCkuZ2V0KCJlcnJvciIsIHt9KQogICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZXJyb3JfZGF0YS5nZXQoIm1lc3NhZ2UiLCAiIikKICAgICAgICAgICAgICAgIGVycm9yX2NvZGUgPSBlcnJvcl9kYXRhLmdldCgiY29kZSIsICIiKQoKICAgICAgICAgICAgICAgIGlmICJJbnZhbGlkIE9BdXRoIGFjY2VzcyB0b2tlbiIgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIEZhbHNlLCAiSW52YWxpZCBUb2tlbiIsIHVhCiAgICAgICAgICAgICAgICBlbGlmIGVycm9yX2NvZGUgPT0gMTkwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIEZhbHNlLCAiVG9rZW4gRXhwaXJlZCIsIHVhCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2Nlc3NfdG9rZW4sIEZhbHNlLCBmIkVycm9yOiB7ZXJyb3JfbXNnfSIsIHVhCgogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgcmV0dXJuIGFjY2Vzc190b2tlbiwgRmFsc2UsIGYiRXJyb3I6IHtyLnRleHR9IiwgdWEKCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIE5vbmUsIEZhbHNlLCBmIkV4Y2VwdGlvbjoge3N0cihlKX0iLCBOb25lCgogICAgCmRlZiBtb3ZlX2JhZF90b2tlbihvcmlnaW5hbF9maWxlLCBiYWRfdG9rZW4sIHJlYXNvbik6CiAgICAiIiJNb3ZlIGEgYmFkIHRva2VuIGludG8gdGhlIHByb3BlciBmaWxlIGFuZCByZW1vdmUgaXQgZnJvbSB0aGUgb3JpZ2luYWwgZmlsZS4iIiIKICAgIGlmIHJlYXNvbiA9PSAicmVzdHJpY3RlZCI6CiAgICAgICAgc2F2ZV9maWxlID0gIi9zZGNhcmQvRkItU01NL0FDQ09VTlRSRVNUUklDVEVELnR4dCIKICAgIGVsaWYgcmVhc29uID09ICJpbnZhbGlkIjoKICAgICAgICBzYXZlX2ZpbGUgPSAiL3NkY2FyZC9GQi1TTU0vSU5WQUxJRFRPS0VOLnR4dCIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICAjIHNhZmV0eSBndWFyZAoKICAgICMgU2F2ZSB0b2tlbiB0byB0aGUgcmVzcGVjdGl2ZSBmaWxlCiAgICB3aXRoIG9wZW4oc2F2ZV9maWxlLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgZi53cml0ZShiYWRfdG9rZW4uc3RyaXAoKSArICJcbiIpCgogICAgIyBSZW1vdmUgdG9rZW4gZnJvbSB0aGUgb3JpZ2luYWwgZmlsZQogICAgd2l0aCBvcGVuKG9yaWdpbmFsX2ZpbGUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkKICAgIHVwZGF0ZWQgPSBbbGluZSBmb3IgbGluZSBpbiBsaW5lcyBpZiBsaW5lLnN0cmlwKCkgIT0gYmFkX3Rva2VuLnN0cmlwKCldCiAgICB3aXRoIG9wZW4ob3JpZ2luYWxfZmlsZSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgIGYud3JpdGVsaW5lcyh1cGRhdGVkKQoKCmRlZiBleHRyYWN0X3Bvc3RfaWQodXJsKToKICAgIHBhdHRlcm5zID0gWwogICAgICAgIHInZ3JvdXBzLyhcZCspL3Blcm1hbGluay8oXGQrKS8nLCAgICMgZ3JvdXAgcG9zdHMKICAgICAgICByJyhcZCspL3Bvc3RzLyhcZCspLycsICAgICAgICAgICAgICAjIHVzZXIvcGFnZSBwb3N0cwogICAgICAgIHInZmJpZD0oXGQrKScsICAgICAgICAgICAgICAgICAgICAgICMgcGhvdG8gcG9zdHMKICAgICAgICByJ3N0b3J5X2ZiaWQ9KFxkKykmaWQ9KFxkKyknICAgICAgICAjIHN0b3J5IHBvc3RzCiAgICBdCiAgICBmb3IgcCBpbiBwYXR0ZXJuczoKICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwLCB1cmwpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiAiXyIuam9pbihtYXRjaC5ncm91cHMoKSkKICAgIHJldHVybiBOb25lCgppbXBvcnQgaXRlcnRvb2xzCmltcG9ydCByZXF1ZXN0cwoKIyDwn5SRIE11bHRpcGxlIHJlYWQgdG9rZW5zIGhlcmUKUkVBRF9BQ0NFU1NfVE9LRU5TID0gWwogICAgIkVBQUFBVWFaQThqbEFCUHZBblJ5UnlvVVhtNnVlQjdWaW1kTzdFeWt6Q2J3OVdKUDNhSVpDSHh0WkNibXNYWGd6TFMyeGVaQ3NkUWRPZlpCSUlOVGVZbGtZVlpBb3dQWG9FRWFHNzZWM3hIWkJtWG5uZnRWTlUyY3paQ0FUdHE1eVduc3pwNkJlcXNTSU9YREJId3pPNFZZQ1haQVNxUFFYTlJGeTZZMVRoRndPdzFhUFJIRWhXRDZQcVpCTHZkMURkZU5WdGpWSElTQWdaRFpEIiwKICAgICJFQUFBQVVhWkE4amxBQlBpbjBUaXk0WEJNMTdIaUJlbVhxNDUxZG1UeUVSMXMzR2M1UWNXYXE2aGFMNkVJRUZPQTlvV3RPbVVuWkJaQWt3N0psVlBrbU5YMmNET0tCSjJlakRBRTB3WkFlQzZpcGtueXBTM0NsM1pCVGkwUDFjS0RzV21TN0pEY3pUanlBZThwQTlVWkJRN3RvREdnZG5NTXZQWUgzVHJxWVZSclJubjdrRWVBQk1qb1RVTkZWSW9sd0R2VU1UMXdaRFpEIiwKICAgICJFQUFBQVVhWkE4amxBQlBycVJrc3praU1UaXdiQ2g5VWgwTHZSWkJqa2VOZk5RdkhCMFF0aXFYY0NwV2tUQkhPTDBRRVdJYnEzMVRzQUY2WkNEcUxxNkZwNjNUWUNhNWRqZ3k5OUVaQWFYVWZ6UHpXY0FWdVd6N3VDeWthVVQzWkJJeVJaQWtOekRiZ3U3QUpkU2IwQkVBUEE2N3lZN0J5dTViNmRSRHF5TVgwbktXVFBWRlllQ1JnNzFoUzJaQUJQcWZBeHhId2VRWkRaRCIKXQoKIyBjeWNsZSB0b2tlbnMgZW5kbGVzc2x5CnRva2VuX2N5Y2xlID0gaXRlcnRvb2xzLmN5Y2xlKFJFQURfQUNDRVNTX1RPS0VOUykKCmRlZiBnZXRfcmVhY3Rpb25fY291bnRfZm9yX3R5cGUocG9zdF91cmxfb3JfaWQsIHJlYWN0aW9uX3R5cGUpOgogICAgIiIiR2V0IHRvdGFsIGNvdW50IG9mIGEgc3BlY2lmaWMgcmVhY3Rpb24gdHlwZSB1c2luZyBzdW1tYXJ5KHRvdGFsX2NvdW50KSB3aXRoIHRva2VuIHJvdGF0aW9uLiIiIgogICAgcG9zdF9pZCA9IHBvc3RfdXJsX29yX2lkIGlmICJfIiBpbiBwb3N0X3VybF9vcl9pZCBlbHNlIGV4dHJhY3RfcG9zdF9pZChwb3N0X3VybF9vcl9pZCkKICAgIGlmIG5vdCBwb3N0X2lkOgogICAgICAgIHByaW50KCLim5QgQ2Fubm90IGV4dHJhY3QgcG9zdCBJRCBmcm9tIFVSTC4iKQogICAgICAgIHJldHVybiAwCgogICAgdHJpZWRfdG9rZW5zID0gc2V0KCkKCiAgICB3aGlsZSBsZW4odHJpZWRfdG9rZW5zKSA8IGxlbihSRUFEX0FDQ0VTU19UT0tFTlMpOgogICAgICAgIHRva2VuID0gbmV4dCh0b2tlbl9jeWNsZSkKICAgICAgICBpZiB0b2tlbiBpbiB0cmllZF90b2tlbnM6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgdHJpZWRfdG9rZW5zLmFkZCh0b2tlbikKCiAgICAgICAgdXJsID0gKAogICAgICAgICAgICBmImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyMC4wL3twb3N0X2lkfSIKICAgICAgICAgICAgZiI/ZmllbGRzPXJlYWN0aW9ucy50eXBlKHtyZWFjdGlvbl90eXBlfSkuc3VtbWFyeSh0b3RhbF9jb3VudCkubGltaXQoMCkiCiAgICAgICAgICAgIGYiJmFjY2Vzc190b2tlbj17dG9rZW59IgogICAgICAgICkKICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAiVXNlci1BZ2VudCI6IGdlbmVyYXRlX3VzZXJfYWdlbnRfcGgoKQogICAgICAgIH0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKS5qc29uKCkKICAgICAgICAgICAgaWYgImVycm9yIiBpbiByZXNwOgogICAgICAgICAgICAgICAgcHJpbnQoZiLimqDvuI8gVG9rZW4gZmFpbGVkOiB7cmVzcFsnZXJyb3InXVsnbWVzc2FnZSddfSIpCiAgICAgICAgICAgICAgICBjb250aW51ZSAgIyB0cnkgbmV4dCB0b2tlbgoKICAgICAgICAgICAgY291bnQgPSByZXNwLmdldCgicmVhY3Rpb25zIiwge30pLmdldCgic3VtbWFyeSIsIHt9KS5nZXQoInRvdGFsX2NvdW50IiwgMCkKCiAgICAgICAgICAgICMg4pyFIE9ubHkgYWRkICsxIGlmIGNvdW50IOKJpSAxMDAKICAgICAgICAgICAgcmV0dXJuIGNvdW50IAoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBjb250aW51ZQoKICAgIHByaW50KCLim5QgQWxsIHRva2VucyBmYWlsZWQiKQogICAgcmV0dXJuIDAKClVJRF9MT0dfRElSID0gIi9zZGNhcmQvY2hlY2tlciIKb3MubWFrZWRpcnMoVUlEX0xPR19ESVIsIGV4aXN0X29rPVRydWUpClVTRURfVE9LRU5TX0RJUiA9ICIvc2RjYXJkL2NoZWNrZXIvdXNlZF90b2tlbnMiICAjIGZvbGRlciB0byBzdG9yZSB1c2VkIHRva2Vucwpvcy5tYWtlZGlycyhVU0VEX1RPS0VOU19ESVIsIGV4aXN0X29rPVRydWUpCgpkZWYgc2F2ZV91c2VkX3VpZF90b2tlbihvcmlnaW5hbF9maWxlLCB0b2tlbl9saW5lKToKICAgICIiIgogICAgUmVtb3ZlIGEgdXNlZCB0b2tlbiBsaW5lIGZyb20gdGhlIG9yaWdpbmFsIGZpbGUgYW5kIHNhdmUgaXQgaW4gYSBzZXBhcmF0ZSBmaWxlLgogICAgCiAgICBQYXJhbWV0ZXJzOgogICAgLSBvcmlnaW5hbF9maWxlOiBwYXRoIHRvIHRoZSBvcmlnaW5hbCB0b2tlbiBmaWxlCiAgICAtIHRva2VuX2xpbmU6IGZ1bGwgdG9rZW4gbGluZSB0aGF0IHdhcyB1c2VkICh1aWR8cGFzc3dvcmR8YWNjZXNzX3Rva2VuKQogICAgIiIiCgogICAgIyBEZWZpbmUgdGhlIGZpbGUgdG8gc2F2ZSB1c2VkIHRva2VucyAoc2FtZSBuYW1lIGFzIG9yaWdpbmFsIGZpbGUpCiAgICBmaWxlX25hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKG9yaWdpbmFsX2ZpbGUpCiAgICB1c2VkX2ZpbGUgPSBvcy5wYXRoLmpvaW4oVVNFRF9UT0tFTlNfRElSLCBmaWxlX25hbWUpCgogICAgIyBTYXZlIHRoZSB1c2VkIHRva2VuCiAgICB3aXRoIG9wZW4odXNlZF9maWxlLCAiYSIpIGFzIGY6CiAgICAgICAgZi53cml0ZSh0b2tlbl9saW5lLnN0cmlwKCkgKyAiXG4iKQoKICAgICMgUmVtb3ZlIHRoZSB0b2tlbiBmcm9tIHRoZSBvcmlnaW5hbCBmaWxlCiAgICB3aXRoIG9wZW4ob3JpZ2luYWxfZmlsZSwgInIiKSBhcyBmOgogICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQogICAgd2l0aCBvcGVuKG9yaWdpbmFsX2ZpbGUsICJ3IikgYXMgZjoKICAgICAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICAgICAgaWYgbGluZS5zdHJpcCgpICE9IHRva2VuX2xpbmUuc3RyaXAoKTogICMga2VlcCBhbGwgbGluZXMgZXhjZXB0IHRoZSB1c2VkIG9uZQogICAgICAgICAgICAgICAgZi53cml0ZShsaW5lKQoKZGVmIGxvYWRfcmVhY3RlZF91aWRzKHBvc3RfaWQsIHJlYWN0aW9uX3R5cGU9Tm9uZSk6CiAgICBpZiByZWFjdGlvbl90eXBlOgogICAgICAgIGZpbGVfbmFtZSA9IG9zLnBhdGguam9pbihVSURfTE9HX0RJUiwgZiJyZWFjdGVkX3twb3N0X2lkfV97cmVhY3Rpb25fdHlwZX0udHh0IikKICAgIGVsc2U6CiAgICAgICAgZmlsZV9uYW1lID0gb3MucGF0aC5qb2luKFVJRF9MT0dfRElSLCBmInJlYWN0ZWRfe3Bvc3RfaWR9X2FsbC50eHQiKQoKICAgIGlmIG9zLnBhdGguZXhpc3RzKGZpbGVfbmFtZSk6CiAgICAgICAgd2l0aCBvcGVuKGZpbGVfbmFtZSwgInIiKSBhcyBmOgogICAgICAgICAgICByZXR1cm4gc2V0KGxpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmIGlmIGxpbmUuc3RyaXAoKSkKICAgIHJldHVybiBzZXQoKQoKZGVmIHNhdmVfcmVhY3RlZF91aWQocG9zdF9pZCwgdWlkLCByZWFjdGlvbl90eXBlPU5vbmUpOgogICAgIyBTYXZlIGZvciBzcGVjaWZpYyByZWFjdGlvbiB0eXBlCiAgICBpZiByZWFjdGlvbl90eXBlOgogICAgICAgIGZpbGVfdHlwZSA9IG9zLnBhdGguam9pbihVSURfTE9HX0RJUiwgZiJyZWFjdGVkX3twb3N0X2lkfV97cmVhY3Rpb25fdHlwZX0udHh0IikKICAgICAgICB3aXRoIG9wZW4oZmlsZV90eXBlLCAiYSIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUodWlkICsgIlxuIikKCiAgICAjIFNhdmUgZm9yIGdlbmVyYWwgcG9zdCBsb2cKICAgIGZpbGVfYWxsID0gb3MucGF0aC5qb2luKFVJRF9MT0dfRElSLCBmInJlYWN0ZWRfe3Bvc3RfaWR9X2FsbC50eHQiKQogICAgd2l0aCBvcGVuKGZpbGVfYWxsLCAiYSIpIGFzIGY6CiAgICAgICAgZi53cml0ZSh1aWQgKyAiXG4iKQoKaW1wb3J0IG9zCgpwYXRoID0gIi9zZGNhcmQvRkItU01NL0FDQ09VTlQudHh0IgoKIyBNYWtlIHN1cmUgdGhlIGRpcmVjdG9yeSBleGlzdHMKb3MubWFrZWRpcnMob3MucGF0aC5kaXJuYW1lKHBhdGgpLCBleGlzdF9vaz1UcnVlKQoKIyBDcmVhdGUgdGhlIGZpbGUgaWYgaXQgZG9lc24ndCBleGlzdApvcGVuKHBhdGgsICdhJykuY2xvc2UoKQoKCmRlZiBzYXZlX3VpZF91YSh1aWQsIHVhLCBmaWxlbmFtZT0iL3NkY2FyZC9GQi1TTU0vdXNlZF91YS50eHQiKToKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShmInt1aWR9fHt1YX1cbiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBzYXZpbmcgVUlELVVBOiB7ZX0iKQoKIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgQVBQUk9WQUwgU1lTVEVNIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgCAjClVTRVJfS0VZX0ZJTEUgPSAiL3NkY2FyZC91c2VyX2tleS50eHQiCkdJVEhVQl9BUFBST1ZBTF9VUkwgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2dwdGJvb3N0aW5ncGgvYXBwcm92YWwvcmVmcy9oZWFkcy9tYWluL2FwcHJvdmFsLnR4dCIKCiMgR2VuZXJhdGUgYSBuZXcgdW5pcXVlIGtleQpkZWYgZ2VuZXJhdGVfdXNlcl9rZXkoKToKICAgIHBhcnQxID0gJycuam9pbihyYW5kb20uY2hvaWNlcyhzdHJpbmcuYXNjaWlfdXBwZXJjYXNlLCBrPTQpKQogICAgcGFydDIgPSAnJy5qb2luKHJhbmRvbS5jaG9pY2VzKHN0cmluZy5kaWdpdHMsIGs9NSkpCiAgICBwYXJ0MyA9ICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoc3RyaW5nLmFzY2lpX3VwcGVyY2FzZSArIHN0cmluZy5kaWdpdHMsIGs9NSkpCiAgICByZXR1cm4gZiJ7cGFydDF9LXtwYXJ0Mn17cGFydDN9IgoKZGVmIGxvYWRfbG9jYWxfa2V5KCk6CiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKFVTRVJfS0VZX0ZJTEUsICJyIikgYXMgZjoKICAgICAgICAgICAgcmV0dXJuIGYucmVhZCgpLnN0cmlwKCkKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gTm9uZQoKZGVmIHNhdmVfbG9jYWxfa2V5KGtleSk6CiAgICB3aXRoIG9wZW4oVVNFUl9LRVlfRklMRSwgInciKSBhcyBmOgogICAgICAgIGYud3JpdGUoa2V5KQoKZGVmIGxvYWRfYXBwcm92ZWRfa2V5cygpOgogICAgdHJ5OgogICAgICAgIHJlc3AgPSByZXF1ZXN0cy5nZXQoR0lUSFVCX0FQUFJPVkFMX1VSTCwgdGltZW91dD0xMCkKICAgICAgICBpZiByZXNwLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZHMocmVzcC50ZXh0KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4puUIEZhaWxlZCB0byBmZXRjaCBhcHByb3ZlZCBrZXlzOiB7ZX0iKQogICAgcmV0dXJuIFtdCgpkZWYgY2hlY2tfa2V5X2FwcHJvdmVkKGtleSk6CiAgICBhcHByb3ZlZF9rZXlzID0gbG9hZF9hcHByb3ZlZF9rZXlzKCkKICAgIGZvciBlbnRyeSBpbiBhcHByb3ZlZF9rZXlzOgogICAgICAgIGlmIGVudHJ5LmdldCgia2V5IikgPT0ga2V5OgogICAgICAgICAgICBleHBpcmVzID0gZW50cnkuZ2V0KCJleHBpcmVzIikKICAgICAgICAgICAgaWYgZXhwaXJlczoKICAgICAgICAgICAgICAgIGV4cGlyZV9kYXRlID0gZGF0ZXRpbWUuc3RycHRpbWUoZXhwaXJlcywgIiVZLSVtLSVkIikKICAgICAgICAgICAgICAgIGlmIGV4cGlyZV9kYXRlID49IGRhdGV0aW1lLm5vdygpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi4puUIEtleSB7a2V5fSBoYXMgZXhwaXJlZCBvbiB7ZXhwaXJlc30iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgpkZWYgYXBwcm92YWxfY2hlY2soKToKICAgIHVzZXJfa2V5ID0gbG9hZF9sb2NhbF9rZXkoKQogICAgaWYgbm90IHVzZXJfa2V5OgogICAgICAgIHVzZXJfa2V5ID0gZ2VuZXJhdGVfdXNlcl9rZXkoKQogICAgICAgIHNhdmVfbG9jYWxfa2V5KHVzZXJfa2V5KQogICAgICAgIHByaW50KGYi8J+UkSBZb3VyIHVuaXF1ZSBrZXkgaXM6IHt1c2VyX2tleX0iKQogICAgICAgIHByaW50KCLimqDvuI8gU2VuZCB0aGlzIGtleSB0byB0aGUgYWRtaW4gZm9yIGFwcHJvdmFsIG9uIEdpdEh1Yi4gT25jZSBhcHByb3ZlZCwgcmVzdGFydCB0aGUgc2NyaXB0LiIpCiAgICAgICAgZXhpdCgpCgogICAgaWYgbm90IGNoZWNrX2tleV9hcHByb3ZlZCh1c2VyX2tleSk6CiAgICAgICAgcHJpbnQoZiLim5QgWW91ciBrZXkge3VzZXJfa2V5fSBpcyBub3QgYXBwcm92ZWQgb3IgZXhwaXJlZC4gQ29udGFjdCBhZG1pbi4iKQogICAgICAgIGV4aXQoKQoKZGVmIFBlcmZvcm1fcmVhY3Rpb25WMigpOgogICAgIiIiUGVyZm9ybSByZWFjdGlvbnMgd2l0aCBsYXN0LXVzZWQgVUlEIGNoZWNrZXIgKDEgZGF5IHJlc3QpLiIiIgoKICAgICMgU3RlcCAxOiBBc2sgdGhlIHVzZXIgd2hpY2ggZmlsZSB0byB1c2UKICAgIGZpbGVfb3B0aW9ucyA9IHsKICAgICAgICAxOiAiL3NkY2FyZC9GQi1TTU0vQUNDT1VOVC5UWFQiCiAgICB9CiAgICBjbGVhcl9zY3JlZW4oKQogICAgCiAgICBwcmludChmIiIiCntyZWR9IOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgHtyZXNldH0KICAgICAgICAgICB7b3JhbmdlfVsxXSB7Z3JlZW59U1RPUkVEIEFDQ09VTlQgICAgICAgICAgICB7cmVkfVswXSAge3JlZH0gRVhJVCAKe3JlZH0g4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3Jlc2V0fSIiIikKCiAgICB0cnk6CiAgICAgICAgZmlsZV9jaG9pY2UgPSBpbnQoaW5wdXQoZiJ7QkxVRX1DaG9vc2Uge3Jlc2V0fTogIikpCiAgICAgICAgaWYgZmlsZV9jaG9pY2Ugbm90IGluIGZpbGVfb3B0aW9uczoKICAgICAgICAgICAgcHJpbnQoIkludmFsaWQgY2hvaWNlLiIpCiAgICAgICAgICAgIG1haW4oKQogICAgICAgIGZpbGVfcGF0aCA9IGZpbGVfb3B0aW9uc1tmaWxlX2Nob2ljZV0KICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIuIikKICAgICAgICByZXR1cm4KICAgIAogICAgb3JpZ2luYWxfZmlsZSA9IGZpbGVfcGF0aAoKICAgICMgU3RlcCAyOiBMb2FkIHRva2VucwogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgdG9rZW5zID0gW2xpbmUuc3RyaXAoKSBmb3IgbGluZSBpbiBmaWxlLnJlYWRsaW5lcygpIGlmIGxpbmUuc3RyaXAoKV0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGxvYWRpbmcgdG9rZW5zOiB7ZX0iKQogICAgICAgIHJldHVybgoKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcHJpbnQoIk5vIHRva2VucyBhdmFpbGFibGUgZnJvbSB0aGUgc2VsZWN0ZWQgZmlsZS4iKQogICAgICAgIHJldHVybgoKICAgICMgU3RlcCAzOiBQb3N0IElEIGlucHV0CiAgICB6ID0gaW5wdXQoCiAgICAgICAgZiJ7QkxVRX1FbnRlciBQb3N0IExpbmt7cmVzZXR9IDogIikKICAgIHBvc3RfaWQgPSBleHRyYWN0X3Bvc3RfaWRzX3YxKHopIG9yIGdldF9jb21iaW5lZF9kYXRhKHopCiAgICBpZiBub3QgcG9zdF9pZDoKICAgICAgICBwcmludCgiVW5hYmxlIHRvIGV4dHJhY3QgcG9zdCBJRCBmcm9tIHRoZSBVUkwhIikKICAgICAgICByZXR1cm4KICAgIHByaW50KAogICAgICAgIGYiIiJ7QkxVRX1Zb3VyIHBvc3QgVVJMIGlzIDoge3JlZH17cG9zdF9pZH17cmVzZXR9CntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3Jlc2V0fQp7eWVsbG93fUNob29zZSB0aGUgcmVhY3Rpb24gOgp7UkVEfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgHtyZXNldH0Ke1NLWUJMVUV9KDEpIHtncmVlbn1MSUtFCntTS1lCTFVFfSgyKSB7Z3JlZW59TE9WRQp7U0tZQkxVRX0oMykge2dyZWVufVdPVwp7U0tZQkxVRX0oNCkge2dyZWVufVNBRAp7U0tZQkxVRX0oNSkge2dyZWVufUFOR1JZCntTS1lCTFVFfSg2KSB7Z3JlZW59SEFIQQp7U0tZQkxVRX0oNykge2dyZWVufUNBUkUKe1JFRH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIB7cmVzZXR9IiIiKQogICAgCiAgICB0cnk6CiAgICAgICAgcmVhY3Rpb25fY2hvaWNlID0gaW50KGlucHV0KGYie2dyZWVufUNob29zZSA6IHtyZXNldH0iKSkKICAgICAgICByZWFjdGlvbl9tYXAgPSB7MTogIkxJS0UiLCAyOiAiTE9WRSIsIDM6ICJXT1ciLCA0OiAiU0FEIiwgNTogIkFOR1JZIiwgNjogIkhBSEEiLCA3OiAiQ0FSRSJ9CiAgICAgICAgcmVhY3Rpb25fdHlwZSA9IHJlYWN0aW9uX21hcC5nZXQocmVhY3Rpb25fY2hvaWNlKQogICAgICAgIGlmIG5vdCByZWFjdGlvbl90eXBlOgogICAgICAgICAgICBwcmludCgiSW52YWxpZCByZWFjdGlvbiBjaG9pY2UuIikKICAgICAgICAgICAgcmV0dXJuCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBTdGVwIDU6IE51bWJlciBvZiByZWFjdGlvbnMKICAgIGN1cnJlbnRfY291bnQgPSBnZXRfcmVhY3Rpb25fY291bnRfZm9yX3R5cGUocG9zdF9pZCwgcmVhY3Rpb25fdHlwZSkKICAgIHByaW50KGYie1JFRH3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIB7cmVzZXR9IikKICAgIHByaW50KAogICAgICAgIGYie1dISVRFfUN1cnJlbnQge2JsdWV9e3JlYWN0aW9uX3R5cGV9e3Jlc2V0fSBjb3VudCA6IHt5ZWxsb3d9e2N1cnJlbnRfY291bnR9e3Jlc2V0fSIpCiAgICBwcmludChmIntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3Jlc2V0fSIpCiAgICB0cnk6CiAgICAgICAgbnVtX3JlYWN0aW9ucyA9IGludChpbnB1dCgKICAgICAgICAgICAgZiJ7WUVMTE9XfUVudGVyIFJlYWN0aW9uIE5lZWRlZCA6IHtyZXNldH0iKSkKICAgICAgICBwcmludChmIntSRUR94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3Jlc2V0fSIpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludCgiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIGZvciByZWFjdGlvbnMuIikKICAgICAgICByZXR1cm4KCiAgICAjIFN0ZXAgNjogRmlsdGVyIHRva2VucwogICAgcmVhY3RlZF9wZXJfdHlwZSA9IGxvYWRfcmVhY3RlZF91aWRzKHBvc3RfaWQsIHJlYWN0aW9uX3R5cGUpCiAgICByZWFjdGVkX3Blcl9wb3N0ID0gbG9hZF9yZWFjdGVkX3VpZHMocG9zdF9pZCkKICAgIHRva2VucyA9IFt0IGZvciB0IGluIHRva2VucyBpZiB0LnNwbGl0KCd8JylbMF0gbm90IGluIHJlYWN0ZWRfcGVyX3R5cGUgYW5kIHQuc3BsaXQoJ3wnKVswXSBub3QgaW4gcmVhY3RlZF9wZXJfcG9zdF0KCgogICAgaWYgbm90IHRva2VuczoKICAgICAgICBwcmludChmIuKblCBObyB0b2tlbnMgYXZhaWxhYmxlIChhbHJlYWR5IHJlYWN0ZWQpLiIpCiAgICAgICAgcmV0dXJuCiAgICBpZiBudW1fcmVhY3Rpb25zID4gbGVuKHRva2Vucyk6CiAgICAgICAgcHJpbnQoZiLim5QgTm90IGVub3VnaCB0b2tlbnMgdG8gZGVsaXZlciB7bnVtX3JlYWN0aW9uc30gcmVhY3Rpb25zLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgUHJvY2Vzc2luZyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAgIwogICAgbWF4X3dvcmtlcnMgPSAyCiAgICB0b3RhbF9zdWNjZXNzID0gdG90YWxfZmFpbCA9IHJlc3RyaWN0ZWRfY291bnQgPSBpbnZhbGlkX2NvdW50ID0gYWxyZWFkeV9yZWFjdGVkID0gdG9rZW5faW5kZXggPSAwCiAgICBzdWNjZXNzX3VpZHMgPSBbXQoKICAgIHdpdGggVGhyZWFkUG9vbEV4ZWN1dG9yKG1heF93b3JrZXJzPW1heF93b3JrZXJzKSBhcyBleGVjdXRvcjoKICAgICAgICB3aGlsZSB0b3RhbF9zdWNjZXNzIDwgbnVtX3JlYWN0aW9ucyBhbmQgdG9rZW5faW5kZXggPCBsZW4odG9rZW5zKToKICAgICAgICAgICAgcmVtYWluaW5nID0gbnVtX3JlYWN0aW9ucyAtIHRvdGFsX3N1Y2Nlc3MKICAgICAgICAgICAgYmF0Y2hfc2l6ZSA9IG1pbihtYXhfd29ya2VycywgcmVtYWluaW5nLCBsZW4odG9rZW5zKSAtIHRva2VuX2luZGV4KQogICAgICAgICAgICBiYXRjaCA9IHRva2Vuc1t0b2tlbl9pbmRleDp0b2tlbl9pbmRleCArIGJhdGNoX3NpemVdCiAgICAgICAgICAgIGZ1dHVyZXMgPSB7ZXhlY3V0b3Iuc3VibWl0KFBlcmZvcm1fUmVhY3RfUG9zdF9QaG90b19WaWRlb19SZWVscywgdCwgcG9zdF9pZCwgcmVhY3Rpb25fdHlwZSk6IHQgZm9yIHQgaW4gYmF0Y2h9CgogICAgICAgICAgICBmb3IgZnV0dXJlIGluIGFzX2NvbXBsZXRlZChmdXR1cmVzKToKICAgICAgICAgICAgICAgIGlmIHRvdGFsX3N1Y2Nlc3MgPj0gbnVtX3JlYWN0aW9uczoKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgICAgIHRva2VuX2xpbmUgPSBmdXR1cmVzW2Z1dHVyZV0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHN0YXR1cywgbWVzc2FnZSwgdWEgPSBmdXR1cmUucmVzdWx0KCkKICAgICAgICAgICAgICAgICAgICB1aWQgPSB0b2tlbl9saW5lLnNwbGl0KCd8JylbMF0KCiAgICAgICAgICAgICAgICAgICAgaWYgc3RhdHVzIGlzIFRydWUgYW5kIG1lc3NhZ2UgPT0gIlJlYWN0ZWQiOgogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdWNjZXNzICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZV9yZWFjdGVkX3VpZChwb3N0X2lkLCB1aWQsIHJlYWN0aW9uX3R5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVfdWlkX3VhKHVpZCwgdWEpCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NfdWlkcy5hcHBlbmQodWlkKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntHUkVFTn1TVUNDRVNTRlVMTFkgUkVBQ1RFRHtyZXNldH0ge29yYW5nZX17cmVhY3Rpb25fdHlwZX17cmVzZXR9IOKUgOKUgD4ge3llbGxvd317dWlkfXtyZXNldH0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbGlmIHN0YXR1cyBpcyBGYWxzZSBhbmQgIkFscmVhZHkgcmVhY3RlZCIgaW4gbWVzc2FnZToKICAgICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeV9yZWFjdGVkICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7eWVsbG93fXt1aWR9e3Jlc2V0fSDilIDilIA+IHt5ZWxsb3d9U0tJUFBFRCAoQWxyZWFkeSByZWFjdGVkKXtyZXNldH0iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2ZhaWwgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICBpZiAiMTkwIiBpbiBtZXNzYWdlIG9yICJJbnZhbGlkIiBpbiBtZXNzYWdlIG9yICJUb2tlbiBFeHBpcmVkIiBpbiBtZXNzYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52YWxpZF9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlX2JhZF90b2tlbihmaWxlX3BhdGgsIHRva2VuX2xpbmUsICJpbnZhbGlkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie1JFRH1JTlZBTElEIFRPS0VOIOKGkiBtb3ZlZHtyZXNldH0ge29yYW5nZX17cmVhY3Rpb25fdHlwZX17cmVzZXR9IOKUgOKUgD4ge3llbGxvd317dWlkfXtyZXNldH0iKQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGFueSh4IGluIG1lc3NhZ2UubG93ZXIoKSBmb3IgeCBpbiBbIjM2OCIsICJ0ZW1wb3JhcmlseSBibG9ja2VkIiwgImFidXNpdmUiLCAiZGlzYWxsb3dlZCJdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RyaWN0ZWRfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZV9iYWRfdG9rZW4oZmlsZV9wYXRoLCB0b2tlbl9saW5lLCAicmVzdHJpY3RlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntSRUR9QUNDT1VOVCBSRVNUUklDVEVEIOKGkiBtb3ZlZHtyZXNldH0g4pSA4pSAPiB7eWVsbG93fXt1aWR9e3Jlc2V0fSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntSRUR9RkFJTEVEIFRPIFJFQUNUe3Jlc2V0fSB7b3JhbmdlfXtyZWFjdGlvbl90eXBlfXtyZXNldH0g4pSA4pSAPiB7eWVsbG93fXt1aWR9e3Jlc2V0fSIpCiAgICAKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICAgW1JFQUNUT1JdIEVSUk9SIHByb2Nlc3NpbmcgdG9rZW46IHtlfSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdG90YWxfc3VjY2VzcyA+PSBudW1fcmVhY3Rpb25zOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICB0b2tlbl9pbmRleCArPSBiYXRjaF9zaXplCgogICAgIyBTdGVwIDk6IFN1bW1hcnkKICAgIHByaW50KGYie2JsdWV94pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAe3Jlc2V0fSIpCiAgICBwcmludChmIntncmVlbn1UT1RBTCBTVUNDRVNTRlVMIFJFQUNUSU9OUyA6IHt0b3RhbF9zdWNjZXNzfXtyZXNldH0iKQogICAgcHJpbnQoZiJ7eWVsbG93fVRPVEFMIFJFU1RSSUNURUQgTU9WRUQgOiB7cmVzdHJpY3RlZF9jb3VudH17cmVzZXR9IikKICAgIHByaW50KGYie3llbGxvd31UT1RBTCBJTlZBTElEIE1PVkVEIDoge2ludmFsaWRfY291bnR9e3Jlc2V0fSIpCiAgICBwcmludChmIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgHtyZXNldH0iKQoKZGVmIG1haW4oKToKICAgICMgU29mdGVyIEFOU0kgY29sb3JzCiAgICBibHVlID0gIlwwMzNbMzRtIiAgICAgIyBkYXJrIGJsdWUKICAgIHJlZCA9ICJcMDMzWzMxbSIgICAgICAjIGRhcmsgcmVkCiAgICB5ZWxsb3cgPSAiXDAzM1szM20iICAgIyBkYXJrIHllbGxvdwogICAgZ3JlZW4gPSAiXDAzM1szMm0iICAgICMgZ3JlZW4KICAgIHJlc2V0ID0gIlwwMzNbMG0iCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICAjIE1ha2Ugc3VyZSBmaWxlcyBleGlzdAogICAgICAgIGZvciBwYXRoIGluIFsnL3NkY2FyZC9GQi1TTU0vQUNDT1VOVC50eHQnXToKICAgICAgICAgICAgb3BlbihwYXRoLCAnYScpLmNsb3NlKCkKCiAgICAgICAgIyBDb3VudCBhY2NvdW50cyBhbmQgcGFnZXMKICAgICAgICB0b3RhbF9hY2NvdW50cz0gY291bnRfdG9rZW5zKCcvc2RjYXJkL0ZCLVNNTS9BQ0NPVU5ULnR4dCcpCiAgICAgICAgcHJpbnQoZiIiIntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgHtyZXNldH0Ke29yYW5nZX0gRmFjZWJvb2sgQXV0byBSZWFjdGlvbiBCb3R7cmVzZXR9ICAgICAgICAgIHtyZWR9U1RPUkVEIEFDQ09VTlR7cmVzZXR9IDoge3llbGxvd317dG90YWxfYWNjb3VudHN9e3Jlc2V0fQp7Ymx1ZX3ilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIB7cmVzZXR9CntvcmFuZ2V9WyAxIF17cmVzZXR9IHtTS1lCTFVFfUVYVFJBQ1RJT057cmVzZXR9ICAgICAgICAgICAgICAgICAgICB7b3JhbmdlfS0gW0FjY3VyYXRlXXtyZXNldH0Ke29yYW5nZX1bIDIgXXtyZXNldH0ge1NLWUJMVUV9UkVBQ1QgVE8gUE9TVHtyZXNldH0gICAgICAgICAgICAgICAgIHtvcmFuZ2V9LSBbVXNhYmxlL0FjdGl2ZV17cmVzZXR9CntvcmFuZ2V9WyAwIF17cmVzZXR9IHtTS1lCTFVFfUVYSVQgVE9PTHtyZXNldH0gCntibHVlfeKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgHtyZXNldH0iIiIpCiAgICAgICAgY2hvaWNlID0gaW5wdXQoIkNIT0lDRSA6ICIpLnN0cmlwKCkKICAgICAgICAjIEV4ZWN1dGUgY2hvaWNlCiAgICAgICAgaWYgY2hvaWNlID09ICcxJzoKICAgICAgICAgICAgZXh0cmFjdGlvbl9hY2NvdW50KCkKICAgICAgICBlbGlmIGNob2ljZSA9PSAnMic6CiAgICAgICAgICAgIFBlcmZvcm1fcmVhY3Rpb25WMigpCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gJzAnOgogICAgICAgICAgICBtYWluKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIntyZXNldH1JbnZhbGlkIGNob2ljZS4iKQogICAgICAgIGlucHV0KCJcblByZXNzIEVOVEVSIHRvIHJldHVybiB0byBtZW51Li4uIikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBhcHByb3ZhbF9jaGVjaygpCiAgICBtYWluKCkK"
src = base64.b64decode(b64).decode("utf8")
# optional: print("Decoded length:", len(src))
exec(compile(src, "reaction-test.py", "exec"), globals(), globals())
